<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ADM Tienda Lite</title>
  <style>
    :root{--pink:#e91e63;--pink-dark:#c2185b;--rose:#ffeef5;--ink:#333}
    body{font-family:'Segoe UI',system-ui,Arial,sans-serif;margin:0;background:var(--rose);color:var(--ink)}
    header{background:var(--pink);color:#fff;padding:1rem 2rem;display:flex;align-items:center;justify-content:space-between}
    header h1{margin:0;font-size:1.6rem}
    header .right{display:flex;gap:.5rem;align-items:center}
    select, input, textarea, button{font:inherit}
    main{padding:2rem;max-width:1100px;margin:auto}

    .guia{background:#fff;padding:1rem 1.2rem;margin-bottom:1rem;border-left:5px solid var(--pink);border-radius:.8rem;box-shadow:0 2px 6px rgba(0,0,0,.08)}
    .guia h2{margin:.2rem 0 .6rem;color:var(--pink)}
    .guia ul{margin:0;padding-left:1.2rem}

    form#productForm{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;margin-bottom:1.2rem;background:#fff;padding:1.2rem;border-radius:.8rem;box-shadow:0 2px 8px rgba(0,0,0,.08);border:2px solid #f8bbd0}
    input,textarea,select{padding:.6rem;border:1px solid #d0d0d0;border-radius:.6rem;width:100%;outline:0}
    input:focus,textarea:focus,select:focus{border-color:var(--pink);box-shadow:0 0 0 3px rgba(233,30,99,.15)}
    textarea{grid-column:1/-1;min-height:60px;resize:vertical}
    .row{display:flex;gap:.5rem;align-items:center}
    .mini{font-size:.85rem;opacity:.8}

    .preview{grid-column:1/-1;display:flex;gap:1rem;align-items:center}
    .preview img{width:72px;height:72px;object-fit:cover;border-radius:.6rem;border:1px solid #eee;background:#fff}
    .preview .ph{width:72px;height:72px;display:grid;place-items:center;border-radius:.6rem;border:1px dashed #ddd;color:#999;background:#fff}

    .controls{display:flex;flex-wrap:wrap;gap:.6rem;margin:1rem 0}
    .controls input,.controls select{background:#fff}

    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    thead th{background:#fce4ec;color:#880e4f;padding:.7rem .8rem;text-align:left}
    tbody td{background:#fff;border:1px solid #eee;border-left:0;border-right:0;padding:.7rem .8rem}
    tbody tr{border-radius:.8rem;box-shadow:0 0 0 rgba(0,0,0,0)}
    tbody tr td:first-child{border-left:1px solid #eee;border-top-left-radius:.8rem;border-bottom-left-radius:.8rem}
    tbody tr td:last-child{border-right:1px solid #eee;border-top-right-radius:.8rem;border-bottom-right-radius:.8rem}
    tbody tr:hover{background:#fff0f6;box-shadow:0 6px 20px rgba(0,0,0,.08)}

    .thumb{display:flex;align-items:center;gap:.6rem;cursor:pointer}
    .thumb img{width:48px;height:48px;object-fit:cover;border-radius:.6rem;border:1px solid #eee;background:#fff}
    .thumb .ph{width:48px;height:48px;display:grid;place-items:center;border-radius:.6rem;border:1px dashed #ddd;color:#999;background:#fff}

    button.primary{background:var(--pink);color:#fff;border:0;border-radius:.6rem;padding:.7rem 1.1rem;cursor:pointer;transition:transform .15s,filter .15s}
    button.primary:hover{filter:brightness(.95)}
    button.primary:active{transform:scale(.98)}
    .btn{background:#9c27b0;color:#fff;border:0;border-radius:.6rem;padding:.6rem 1rem;cursor:pointer}
    .btn.gray{background:#6b7280}
    .btn.green{background:#10b981}
    .btn.red{background:#ef4444}

    .utils{margin-top:1rem;display:flex;gap:.6rem;flex-wrap:wrap}

    #toast{position:fixed;right:14px;bottom:14px;display:grid;gap:8px;z-index:30}
    .toast{background:#101114;color:#fff;padding:.7rem 1rem;border-radius:.8rem;box-shadow:0 12px 40px rgba(0,0,0,.25);opacity:.98}

    th.sort{cursor:pointer;user-select:none}
    th.sort .arrow{opacity:.6;margin-left:.3rem}

    /* Modal */
    #modal{position:fixed;inset:0;background:rgba(16,17,20,.45);display:none;align-items:center;justify-content:center;z-index:60}
    #modal .card{background:#fff;border-radius:.8rem;box-shadow:0 14px 50px rgba(0,0,0,.25);padding:1rem;display:grid;gap:.6rem;width:min(96vw,720px)}
    #modal .top{display:flex;align-items:center;justify-content:space-between}
    #modal img{width:100%;max-height:60vh;object-fit:contain;border-radius:.6rem;background:#fff}
    #closeModal{background:#ef4444;border:0;color:#fff;padding:.4rem .6rem;border-radius:.6rem;cursor:pointer}
  </style>
</head>
<body>
  <header>
    <h1 id="t_title">Panel Administrativo ¬∑ Tienda</h1>
    <div class="right">
      <label class="mini" for="lang">üåê</label>
      <select id="lang">
        <option value="es">ES</option>
        <option value="en">EN</option>
      </select>
    </div>
  </header>
  <main>
    <section class="guia" id="guide">
      <h2 id="t_guide">Gu√≠a r√°pida</h2>
      <ul>
        <li id="t_g1">Completa el formulario y presiona Guardar.</li>
        <li id="t_g2">Usa Editar para cambiar precio/stock/info.</li>
        <li id="t_g3">Borrar elimina el producto.</li>
        <li id="t_g4">Exporta/Importa el cat√°logo abajo.</li>
      </ul>
    </section>

    <form id="productForm">
      <input type="hidden" id="editIndex" />
      <input type="text" id="nombre" placeholder="Nombre" required />
      <div class="row">
        <select id="categoria"></select>
        <input id="newCat" type="text" placeholder="Nueva categor√≠a (opcional)" />
        <button type="button" class="btn" id="addCat">‚ûï</button>
      </div>
      <input type="number" id="precio" placeholder="Precio" min="0" step="0.01" required />
      <input type="number" id="stock" placeholder="Stock" min="0" step="1" required />
      <input type="text" id="imagen" placeholder="URL Imagen" />
      <div class="preview" id="prevBox">
        <div class="ph" id="prevPh">Sin vista previa</div>
        <img id="prevImg" alt="preview" style="display:none" />
        <span class="mini" id="prevMsg"></span>
      </div>
      <textarea id="descripcion" placeholder="Descripci√≥n"></textarea>
      <button type="submit" class="primary" style="grid-column:1/-1" id="t_save">Guardar Producto</button>
    </form>

    <div class="controls">
      <input id="buscar" type="text" placeholder="Buscar por nombre..." />
      <select id="filtraCategoria"><option value="">Todas las categor√≠as</option></select>
    </div>

    <table id="productTable">
      <thead>
        <tr>
          <th>Imagen</th>
          <th class="sort" data-k="nombre">Nombre <span class="arrow">‚Üï</span></th>
          <th class="sort" data-k="categoria">Categor√≠a <span class="arrow">‚Üï</span></th>
          <th class="sort" data-k="precio">Precio <span class="arrow">‚Üï</span></th>
          <th class="sort" data-k="stock">Stock <span class="arrow">‚Üï</span></th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="utils">
      <button class="btn" onclick="exportarJSON()" id="t_export_json">‚¨áÔ∏è Exportar JSON</button>
      <button class="btn gray" onclick="exportarCSV()" id="t_export_csv">‚¨áÔ∏è Exportar CSV</button>
      <button class="btn red" onclick="vaciar()">üßπ Vaciar cat√°logo</button>
      <label for="importFile" class="btn">‚¨ÜÔ∏è Importar JSON</label>
      <input type="file" id="importFile" accept="application/json" style="display:none" />
    </div>
  </main>

  <div id="modal" aria-hidden="true">
    <div class="card">
      <div class="top">
        <h3 id="m_title" style="margin:.2rem 0"></h3>
        <button id="closeModal">‚úï</button>
      </div>
      <img id="m_img" alt="imagen" />
      <div class="mini" id="m_meta"></div>
      <p id="m_desc" style="margin:.2rem 0 0"></p>
    </div>
  </div>

  <div id="toast"></div>

  <script>
    const LS_K='admLite_catalogo';
    const DEFAULT_CATS=['Ropa','Accesorios','Belleza','Hogar','Otros'];
    let productos=[];let sortBy=null,sortDir=1;let lang='es';

    const i18n={
      es:{title:'Panel Administrativo ¬∑ Tienda',guide:'Gu√≠a r√°pida',g1:'Completa el formulario y presiona Guardar.',g2:'Usa Editar para cambiar precio/stock/info.',g3:'Borrar elimina el producto.',g4:'Exporta/Importa el cat√°logo abajo.',save:'Guardar Producto',exJson:'‚¨áÔ∏è Exportar JSON',exCsv:'‚¨áÔ∏è Exportar CSV',search:'Buscar por nombre...',allCat:'Todas las categor√≠as'},
      en:{title:'Admin Panel ¬∑ Store',guide:'Quick guide',g1:'Fill the form and press Save.',g2:'Use Edit to change price/stock/info.',g3:'Delete removes the product.',g4:'Export/Import catalog below.',save:'Save Product',exJson:'‚¨áÔ∏è Export JSON',exCsv:'‚¨áÔ∏è Export CSV',search:'Search by name...',allCat:'All categories'}
    };
    function applyI18n(){const t=i18n[lang];document.getElementById('t_title').textContent=t.title;document.getElementById('t_guide').textContent=t.guide;document.getElementById('t_g1').textContent=t.g1;document.getElementById('t_g2').textContent=t.g2;document.getElementById('t_g3').textContent=t.g3;document.getElementById('t_g4').textContent=t.g4;document.getElementById('t_save').textContent=t.save;document.getElementById('t_export_json').textContent=t.exJson;document.getElementById('t_export_csv').textContent=t.exCsv;document.getElementById('buscar').placeholder=t.search;document.querySelector('#filtraCategoria option[value=""]').textContent=t.allCat}

    function toast(msg){const c=document.getElementById('toast');const el=document.createElement('div');el.className='toast';el.textContent=msg;c.appendChild(el);setTimeout(()=>{el.style.opacity=.0;setTimeout(()=>el.remove(),240)},1600)}

    function esc(s){return String(s??'').replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]))}
    function sanitizeStr(s){return String(s??'').replace(/<[^>]*>/g,'').trim()}
    function safeUrl(u){try{const x=new URL(String(u));if(x.protocol==='http:'||x.protocol==='https:')return x.href}catch{}return ''}

    function loadLS(){try{const raw=localStorage.getItem(LS_K);if(raw){productos=JSON.parse(raw)||[]}}catch{productos=[]}}
    function saveLS(){try{localStorage.setItem(LS_K,JSON.stringify(productos))}catch{}}

    async function cargarCatalogo(){loadLS();try{const res=await fetch('catalogo.json',{cache:'no-store'});if(res.ok){productos=await res.json();saveLS()}}catch{}render();fillFilters()}

    function fillCats(){const set=new Set([...DEFAULT_CATS,...productos.map(p=>p.categoria).filter(Boolean)]);const catSel=document.getElementById('categoria');catSel.innerHTML='<option value="">Seleccionar Categor√≠a</option>'+[...set].map(c=>`<option>${esc(c)}</option>`).join('')}
    function fillFilters(){const set=new Set(productos.map(p=>p.categoria).filter(Boolean));const f=document.getElementById('filtraCategoria');f.innerHTML=`<option value="">${i18n[lang].allCat}</option>`+[...set].map(c=>`<option>${esc(c)}</option>`).join('')}

    function render(){fillCats();const term=document.getElementById('buscar').value.trim().toLowerCase();const fcat=document.getElementById('filtraCategoria').value;let rows=productos.filter(p=>{const hit=(p.nombre||'').toLowerCase().includes(term);const catOk=!fcat||p.categoria===fcat;return hit&&catOk});if(sortBy){rows=rows.slice().sort((a,b)=>{let A=a[sortBy],B=b[sortBy];if(typeof A==='string')A=A.toLowerCase();if(typeof B==='string')B=B.toLowerCase();return (A>B?1:A<B?-1:0)*sortDir})}
      const tb=document.querySelector('#productTable tbody');tb.innerHTML='';rows.forEach((p)=>{const tr=document.createElement('tr');const idx=productos.indexOf(p);tr.dataset.idx=String(idx);tr.innerHTML=`
        <td class="thumb"><div class="ph">üñºÔ∏è</div><img class="im" style="display:none" alt="thumb"/></td>
        <td>${esc(p.nombre)}</td>
        <td>${esc(p.categoria||'')}</td>
        <td>$${Number(p.precio||0).toFixed(2)}</td>
        <td>${Number(p.stock||0)}</td>
        <td class="actions"><button class="btn green" data-k="ed">‚úèÔ∏è</button><button class="btn red" data-k="rm">üóëÔ∏è</button></td>`;
        const imEl=tr.querySelector('.im');const phEl=tr.querySelector('.ph');const u=safeUrl(p.imagen);if(u){imEl.referrerPolicy='no-referrer';imEl.onload=()=>{phEl.style.display='none';imEl.style.display='block'};imEl.onerror=()=>{imEl.style.display='none';phEl.style.display='grid'};imEl.src=u}else{imEl.style.display='none';phEl.style.display='grid'}
        tr.addEventListener('click',ev=>{if(ev.target.closest('button'))return;showModal(idx)});
        tr.querySelector('[data-k="ed"]').addEventListener('click',()=>editar(idx));
        tr.querySelector('[data-k="rm"]').addEventListener('click',()=>borrar(idx));
        tb.appendChild(tr)});}

    document.getElementById('productForm').addEventListener('submit',e=>{e.preventDefault();const idx=document.getElementById('editIndex').value;let precio=parseFloat(document.getElementById('precio').value);let stock=parseInt(document.getElementById('stock').value);precio=isNaN(precio)||precio<0?0:precio;stock=isNaN(stock)||stock<0?0:stock;const nuevo={nombre:sanitizeStr(document.getElementById('nombre').value),categoria:sanitizeStr(document.getElementById('categoria').value),precio:+precio.toFixed(2),stock:stock,imagen:sanitizeStr(document.getElementById('imagen').value),descripcion:sanitizeStr(document.getElementById('descripcion').value)};if(!nuevo.nombre){toast('Nombre requerido');return}if(idx===''){productos.push(nuevo);toast('Guardado')}else{productos[idx]=nuevo;toast('Actualizado')}e.target.reset();document.getElementById('editIndex').value='';document.getElementById('prevImg').style.display='none';document.getElementById('prevPh').style.display='grid';document.getElementById('prevMsg').textContent='';saveLS();render();fillFilters()});

    function editar(i){const p=productos[i];document.getElementById('editIndex').value=i;document.getElementById('nombre').value=p.nombre;document.getElementById('categoria').value=p.categoria||'';document.getElementById('precio').value=p.precio;document.getElementById('stock').value=p.stock;document.getElementById('imagen').value=p.imagen||'';document.getElementById('descripcion').value=p.descripcion||'';previewImagen();window.scrollTo({top:0,behavior:'smooth'})}
    function borrar(i){if(!confirm('¬øEliminar producto?'))return;productos.splice(i,1);saveLS();render();fillFilters();toast('Eliminado')}
    function vaciar(){if(!confirm('¬øVaciar cat√°logo completo?'))return;productos=[];saveLS();render();fillFilters();toast('Cat√°logo vaciado')}

    function exportarJSON(){const blob=new Blob([JSON.stringify(productos,null,2)],{type:'application/json'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='catalogo.json';a.click()}
    function exportarCSV(){const cols=['nombre','categoria','precio','stock','imagen','descripcion'];const rows=[cols].concat(productos.map(p=>cols.map(k=>String(p[k]??''))));const csv=rows.map(r=>r.map(v=>`"${v.replace(/"/g,'""')}`+`"`).join(',')).join('\n');const blob=new Blob([csv],{type:'text/csv;charset=utf-8;'});const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='catalogo.csv';a.click()}

    document.getElementById('importFile').addEventListener('change',e=>{const f=e.target.files[0];if(!f)return;const r=new FileReader();r.onload=ev=>{try{const arr=JSON.parse(ev.target.result)||[];productos=(Array.isArray(arr)?arr:[]).map(p=>({nombre:sanitizeStr(p.nombre),categoria:sanitizeStr(p.categoria),precio:Math.max(0,Number(p.precio)||0),stock:Math.max(0,parseInt(p.stock)||0),imagen:sanitizeStr(p.imagen),descripcion:sanitizeStr(p.descripcion)}));saveLS();render();fillFilters();toast('Cat√°logo importado')}catch{toast('JSON inv√°lido')}};r.readAsText(f)});

    function previewImagen(){const u=safeUrl(document.getElementById('imagen').value.trim());const img=document.getElementById('prevImg');const ph=document.getElementById('prevPh');const msg=document.getElementById('prevMsg');if(!u){img.style.display='none';ph.style.display='grid';msg.textContent='';return}img.onload=()=>{ph.style.display='none';img.style.display='block';msg.textContent='Vista previa'};img.onerror=()=>{img.style.display='none';ph.style.display='grid';msg.textContent='No se pudo cargar'};img.referrerPolicy='no-referrer';img.src=u}
    document.getElementById('imagen').addEventListener('input',previewImagen);

    function showModal(i){const p=productos[i];const m=document.getElementById('modal');const t=document.getElementById('m_title');const im=document.getElementById('m_img');const meta=document.getElementById('m_meta');const d=document.getElementById('m_desc');t.textContent=p.nombre||'';meta.textContent=`${p.categoria||'‚Äî'} ‚Ä¢ $${Number(p.precio||0).toFixed(2)} ‚Ä¢ Stock: ${Number(p.stock||0)}`;d.textContent=p.descripcion||'';const u=safeUrl(p.imagen);if(u){im.referrerPolicy='no-referrer';im.src=u}else{im.removeAttribute('src')}m.style.display='flex';m.setAttribute('aria-hidden','false')}
    document.getElementById('closeModal').addEventListener('click',()=>{const m=document.getElementById('modal');m.style.display='none';m.setAttribute('aria-hidden','true')});
    document.getElementById('modal').addEventListener('click',e=>{if(e.target.id==='modal'){e.currentTarget.style.display='none';e.currentTarget.setAttribute('aria-hidden','true')}});

    document.getElementById('buscar').addEventListener('input',()=>render());
    document.getElementById('filtraCategoria').addEventListener('change',()=>render());

    document.querySelectorAll('th.sort').forEach(th=>th.addEventListener('click',()=>{const k=th.dataset.k;if(sortBy===k){sortDir*=-1}else{sortBy=k;sortDir=1}document.querySelectorAll('th.sort .arrow').forEach(a=>a.textContent='‚Üï');th.querySelector('.arrow').textContent=sortDir>0?'‚Üë':'‚Üì';render()}));

    document.getElementById('addCat').addEventListener('click',()=>{const v=sanitizeStr(document.getElementById('newCat').value);if(!v)return;DEFAULT_CATS.push(v);document.getElementById('newCat').value='';fillCats();document.getElementById('categoria').value=v;toast('Categor√≠a a√±adida')});

    document.getElementById('lang').addEventListener('change',e=>{lang=e.target.value;applyI18n()});

    applyI18n();
    cargarCatalogo();
  </script>
</body>
</html>
